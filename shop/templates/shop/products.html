{% extends "shop/base.html" %}
{% block content %}
{% load static %}

<div class="container my-5 px-4 max-w-6xl mx-auto">
    <h2 class="text-center font-bold text-2xl mb-6">All Products</h2>

    <!-- 🔍 Search & Filters -->
<form method="get" 
      class="grid grid-cols-1 md:grid-cols-5 gap-3 bg-white p-3 rounded-lg shadow mb-5 sm:gap-4 sm:p-4 sm:rounded-xl">

    <!-- Search -->
    <input type="text" name="q" placeholder="Search medicines or cosmetics..."
           value="{{ request.GET.q }}"
           class="col-span-1 md:col-span-2 border p-2 rounded-md shadow w-full text-sm sm:text-base">

    <!-- Category -->
    <select name="category" class="border p-2 rounded-md shadow w-full text-sm sm:text-base">
        <option value="all" {% if request.GET.category == "all" %}selected{% endif %}>All Categories</option>
        <option value="medicine" {% if request.GET.category == "medicine" %}selected{% endif %}>Medicines</option>
        <option value="cosmetic" {% if request.GET.category == "cosmetic" %}selected{% endif %}>Cosmetics</option>
        <option value="other" {% if request.GET.category == "other" %}selected{% endif %}>Others</option>
    </select>

    <!-- Sorting -->
    <select name="sort" class="border p-2 rounded-md shadow w-full text-sm sm:text-base">
        <option value="">Sort By</option>
        <option value="price_low" {% if request.GET.sort == "price_low" %}selected{% endif %}>Price: Low → High</option>
        <option value="price_high" {% if request.GET.sort == "price_high" %}selected{% endif %}>Price: High → Low</option>
        <option value="newest" {% if request.GET.sort == "newest" %}selected{% endif %}>Newest First</option>
    </select>

    <!-- Buttons -->
    <div class="flex gap-2 md:col-span-5 justify-end">
        <button type="submit" class="bg-green-600 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg shadow hover:bg-green-700 text-sm sm:text-base">
            Apply
        </button>
        <a href="{% url 'products' %}" class="bg-gray-500 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg shadow hover:bg-gray-600 text-sm sm:text-base">
            Clear
        </a>
    </div>
</form>


<!-- 🛒 Products Grid -->
<!-- 🛒 Products Grid -->
<div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
    {% for product in page_obj %}
    <div class="bg-white rounded-xl shadow p-4 sm:p-5 text-center hover:shadow-lg transition 
                min-h-[200px] sm:min-h-[240px]">

        <!-- Product Name -->
        <h3 class="font-bold text-base sm:text-lg text-gray-800 leading-snug">
            {{ product.name }}
        </h3>

        <!-- Description -->
        <p class="text-gray-600 mt-2 text-sm sm:mt-2 sm:text-sm leading-tight">
            {{ product.description|truncatechars:100 }}
        </p>

        <!-- Price Section -->
        <div class="mt-3 sm:mt-4">
            <p class="text-gray-500 text-sm sm:text-sm line-through">
                MRP: ₹{{ product.mrp }}
            </p>
            <p class="text-green-600 font-bold text-base sm:text-lg">
                Our Price: ₹{{ product.price }}
            </p>
            {% with discount=product.discount_percent %}
                {% if discount %}
                    <p class="text-red-600 text-sm sm:text-sm font-semibold">
                        {{ discount }}% OFF
                    </p>
                {% endif %}
            {% endwith %}
        </div>

        <!-- Add to Cart Button -->
        <a href="{% url 'add_to_cart' product.id %}" 
           class="mt-3 sm:mt-4 inline-block bg-green-600 text-white px-4 py-2 sm:px-5 sm:py-2 rounded-lg hover:bg-green-700 transition text-sm sm:text-base">
           Add to Cart
        </a>
    </div>
    {% empty %}
    <p class="col-span-2 lg:col-span-3 text-center text-gray-500">No products found.</p>
    {% endfor %}
</div>



    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="flex justify-center mt-8">
        <nav class="flex items-center space-x-2">
            {% if page_obj.has_previous %}
                <a href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}"
                   class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Prev</a>
            {% endif %}

            <span class="px-4 py-1 bg-green-600 text-white rounded">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}"
                   class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next</a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}
